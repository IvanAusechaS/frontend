{"ast":null,"code":"// frontend/src/pages/ProfesionalDashboard.js\nimport React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';// Añadido para manejar redirecciones\nimport{getTurnos,updateTurno}from'../services/api';import Nav from'../components/Nav';import Footer from'../components/Footer';import'./ProfesionalDashboard.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const ProfesionalDashboard=_ref=>{let{user:userProp,setUser}=_ref;const[turnos,setTurnos]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState('');const navigate=useNavigate();const user=userProp||JSON.parse(localStorage.getItem('user'))||{};console.log('Usuario en ProfesionalDashboard:',user);// Depuración\nuseEffect(()=>{const fetchTurnos=async()=>{try{const token=localStorage.getItem('token');if(!token){setError('Debes iniciar sesión para acceder a esta página.');navigate('/login');return;}const data=await getTurnos();// Token manejado por interceptor\nsetTurnos(data);setLoading(false);}catch(err){var _err$response;if(((_err$response=err.response)===null||_err$response===void 0?void 0:_err$response.status)===401){setError('Sesión expirada. Por favor, inicia sesión nuevamente.');localStorage.removeItem('token');localStorage.removeItem('refreshToken');localStorage.removeItem('user');setUser(null);navigate('/login');}else{setError('Error al cargar turnos');}setLoading(false);}};fetchTurnos();},[navigate,setUser]);const handleEstadoChange=async(turnoId,nuevoEstado)=>{try{const updatedTurno=await updateTurno(turnoId,nuevoEstado);// Token manejado por interceptor\nsetTurnos(turnos.map(turno=>turno.id===turnoId?{...turno,estado:updatedTurno.estado,fecha_atencion:updatedTurno.fecha_atencion}:turno));}catch(err){var _err$response2,_err$response3,_err$response3$data;console.error('Error al actualizar el turno:',((_err$response2=err.response)===null||_err$response2===void 0?void 0:_err$response2.data)||err.message);setError(`Error al actualizar el turno: ${((_err$response3=err.response)===null||_err$response3===void 0?void 0:(_err$response3$data=_err$response3.data)===null||_err$response3$data===void 0?void 0:_err$response3$data.detail)||err.message}`);}};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Nav,{user:user,setUser:setUser}),/*#__PURE__*/_jsxs(\"div\",{className:\"dashboard-container\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"dashboard-title\",children:\"Dashboard Profesional\"}),loading&&/*#__PURE__*/_jsx(\"p\",{className:\"dashboard-text\",children:\"Cargando...\"}),error&&/*#__PURE__*/_jsx(\"p\",{className:\"dashboard-error\",children:error}),!loading&&!error&&/*#__PURE__*/_jsxs(\"div\",{className:\"turnos-table-wrapper\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"dashboard-subtitle\",children:\"Mis Turnos\"}),turnos.length>0?/*#__PURE__*/_jsxs(\"table\",{className:\"turnos-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"N\\xFAmero\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Paciente\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Tipo\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Fecha\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Hora\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Estado\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Acci\\xF3n\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:turnos.map(turno=>/*#__PURE__*/_jsxs(\"tr\",{className:`turno-row estado-${turno.estado.toLowerCase().replace(' ','-')}`,children:[/*#__PURE__*/_jsx(\"td\",{\"data-label\":\"N\\xFAmero\",children:turno.numero}),/*#__PURE__*/_jsx(\"td\",{\"data-label\":\"Paciente\",children:turno.usuario}),/*#__PURE__*/_jsx(\"td\",{\"data-label\":\"Tipo\",children:turno.tipo_cita}),/*#__PURE__*/_jsx(\"td\",{\"data-label\":\"Fecha\",children:new Date(turno.fecha_cita).toLocaleDateString()}),/*#__PURE__*/_jsx(\"td\",{\"data-label\":\"Hora\",children:new Date(turno.fecha_cita).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})}),/*#__PURE__*/_jsx(\"td\",{\"data-label\":\"Estado\",children:turno.estado}),/*#__PURE__*/_jsx(\"td\",{\"data-label\":\"Acci\\xF3n\",children:/*#__PURE__*/_jsxs(\"select\",{value:turno.estado,onChange:e=>handleEstadoChange(turno.id,e.target.value),className:\"estado-select\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"En espera\",children:\"En espera\"}),/*#__PURE__*/_jsx(\"option\",{value:\"En progreso\",children:\"En progreso\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Atendido\",children:\"Atendido\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Cancelado\",children:\"Cancelado\"})]})})]},turno.id))})]}):/*#__PURE__*/_jsx(\"p\",{className:\"dashboard-text\",children:\"No hay turnos asignados.\"})]})]}),/*#__PURE__*/_jsx(Footer,{})]});};export default ProfesionalDashboard;","map":{"version":3,"names":["React","useState","useEffect","useNavigate","getTurnos","updateTurno","Nav","Footer","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","ProfesionalDashboard","_ref","user","userProp","setUser","turnos","setTurnos","loading","setLoading","error","setError","navigate","JSON","parse","localStorage","getItem","console","log","fetchTurnos","token","data","err","_err$response","response","status","removeItem","handleEstadoChange","turnoId","nuevoEstado","updatedTurno","map","turno","id","estado","fecha_atencion","_err$response2","_err$response3","_err$response3$data","message","detail","children","className","length","toLowerCase","replace","numero","usuario","tipo_cita","Date","fecha_cita","toLocaleDateString","toLocaleTimeString","hour","minute","value","onChange","e","target"],"sources":["C:/Users/ivana/.vscode/Proyecto DSI/frontend/src/pages/ProfesionalDashboard.js"],"sourcesContent":["// frontend/src/pages/ProfesionalDashboard.js\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom'; // Añadido para manejar redirecciones\r\nimport { getTurnos, updateTurno } from '../services/api';\r\nimport Nav from '../components/Nav';\r\nimport Footer from '../components/Footer';\r\nimport './ProfesionalDashboard.css';\r\n\r\nconst ProfesionalDashboard = ({ user: userProp, setUser }) => {\r\n  const [turnos, setTurnos] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n  const navigate = useNavigate();\r\n  const user = userProp || JSON.parse(localStorage.getItem('user')) || {};\r\n\r\n  console.log('Usuario en ProfesionalDashboard:', user); // Depuración\r\n\r\n  useEffect(() => {\r\n    const fetchTurnos = async () => {\r\n      try {\r\n        const token = localStorage.getItem('token');\r\n        if (!token) {\r\n          setError('Debes iniciar sesión para acceder a esta página.');\r\n          navigate('/login');\r\n          return;\r\n        }\r\n        const data = await getTurnos(); // Token manejado por interceptor\r\n        setTurnos(data);\r\n        setLoading(false);\r\n      } catch (err) {\r\n        if (err.response?.status === 401) {\r\n          setError('Sesión expirada. Por favor, inicia sesión nuevamente.');\r\n          localStorage.removeItem('token');\r\n          localStorage.removeItem('refreshToken');\r\n          localStorage.removeItem('user');\r\n          setUser(null);\r\n          navigate('/login');\r\n        } else {\r\n          setError('Error al cargar turnos');\r\n        }\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchTurnos();\r\n  }, [navigate, setUser]);\r\n\r\n  const handleEstadoChange = async (turnoId, nuevoEstado) => {\r\n    try {\r\n      const updatedTurno = await updateTurno(turnoId, nuevoEstado); // Token manejado por interceptor\r\n      setTurnos(turnos.map(turno =>\r\n        turno.id === turnoId ? { ...turno, estado: updatedTurno.estado, fecha_atencion: updatedTurno.fecha_atencion } : turno\r\n      ));\r\n    } catch (err) {\r\n      console.error('Error al actualizar el turno:', err.response?.data || err.message);\r\n      setError(`Error al actualizar el turno: ${err.response?.data?.detail || err.message}`);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Nav user={user} setUser={setUser} />\r\n      <div className=\"dashboard-container\">\r\n        <h2 className=\"dashboard-title\">Dashboard Profesional</h2>\r\n        {loading && <p className=\"dashboard-text\">Cargando...</p>}\r\n        {error && <p className=\"dashboard-error\">{error}</p>}\r\n        {!loading && !error && (\r\n          <div className=\"turnos-table-wrapper\">\r\n            <h3 className=\"dashboard-subtitle\">Mis Turnos</h3>\r\n            {turnos.length > 0 ? (\r\n              <table className=\"turnos-table\">\r\n                <thead>\r\n                  <tr>\r\n                    <th>Número</th>\r\n                    <th>Paciente</th>\r\n                    <th>Tipo</th>\r\n                    <th>Fecha</th>\r\n                    <th>Hora</th>\r\n                    <th>Estado</th>\r\n                    <th>Acción</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {turnos.map((turno) => (\r\n                    <tr key={turno.id} className={`turno-row estado-${turno.estado.toLowerCase().replace(' ', '-')}`}>\r\n                      <td data-label=\"Número\">{turno.numero}</td>\r\n                      <td data-label=\"Paciente\">{turno.usuario}</td>\r\n                      <td data-label=\"Tipo\">{turno.tipo_cita}</td>\r\n                      <td data-label=\"Fecha\">{new Date(turno.fecha_cita).toLocaleDateString()}</td>\r\n                      <td data-label=\"Hora\">{new Date(turno.fecha_cita).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</td>\r\n                      <td data-label=\"Estado\">{turno.estado}</td>\r\n                      <td data-label=\"Acción\">\r\n                        <select\r\n                          value={turno.estado}\r\n                          onChange={(e) => handleEstadoChange(turno.id, e.target.value)}\r\n                          className=\"estado-select\"\r\n                        >\r\n                          <option value=\"En espera\">En espera</option>\r\n                          <option value=\"En progreso\">En progreso</option>\r\n                          <option value=\"Atendido\">Atendido</option>\r\n                          <option value=\"Cancelado\">Cancelado</option>\r\n                        </select>\r\n                      </td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            ) : (\r\n              <p className=\"dashboard-text\">No hay turnos asignados.</p>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n      <Footer />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default ProfesionalDashboard;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}